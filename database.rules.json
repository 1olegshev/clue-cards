{
  "rules": {
    "rooms": {
      "$roomCode": {
        ".read": "auth != null",
        ".write": "auth != null && (!data.exists() || root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid)",

        "ownerId": {
          ".write": "auth != null && (!data.exists() || data.val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(data.val()).child('connected').val() === false)"
        },

        "gameStarted": {
          ".write": "auth != null && root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid"
        },
        "gameOver": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser')"
        },
        "winner": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser')"
        },
        "paused": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser')"
        },
        "pauseReason": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser')"
        },
        "pausedForTeam": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser')"
        },

        "currentTeam": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser')"
        },
        "startingTeam": {
          ".write": "auth != null && root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid"
        },
        "turnStartTime": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser' || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'clueGiver')"
        },
        "turnDuration": {
          ".write": "auth != null && root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid && !root.child('rooms').child($roomCode).child('gameStarted').val()",
          ".validate": "newData.isNumber() && (newData.val() === 30 || newData.val() === 60 || newData.val() === 90)"
        },

        "wordPack": {
          ".write": "auth != null && root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid && !root.child('rooms').child($roomCode).child('gameStarted').val()",
          ".validate": "newData.isString() && (newData.val() === 'classic' || newData.val() === 'kahoot')"
        },

        "currentClue": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'clueGiver' || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser')",
          ".validate": "!newData.exists() || (newData.child('word').isString() && newData.child('word').val().length > 0 && newData.child('word').val().length <= 30 && newData.child('count').isNumber() && newData.child('count').val() >= 0)"
        },
        "remainingGuesses": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'clueGiver' || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser')",
          ".validate": "!newData.exists() || (newData.isNumber() && newData.val() >= 0)"
        },

        "createdAt": {
          ".write": "auth != null && !data.exists()"
        },

        "board": {
          ".write": "auth != null && (root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'clueGiver' || root.child('rooms').child($roomCode).child('players').child(auth.uid).child('role').val() === 'guesser')",
          "$cardIndex": {
            "word": {
              ".validate": "newData.isString()"
            },
            "team": {
              ".validate": "newData.isString() && (newData.val() === 'red' || newData.val() === 'blue' || newData.val() === 'neutral' || newData.val() === 'trap')"
            },
            "revealed": {
              ".validate": "newData.isBoolean()"
            },
            "revealedBy": {
              ".validate": "!newData.exists() || newData.isString()"
            },
            "votes": {
              "$voterId": {
                ".write": "auth != null && $voterId === auth.uid",
                ".validate": "newData.isBoolean() || !newData.exists()"
              }
            }
          }
        },

        "players": {
          "$playerId": {
            ".write": "auth != null && ($playerId === auth.uid || root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid)",
            ".validate": "newData.child('name').isString() && newData.child('name').val().length > 0 && newData.child('name').val().length <= 20",
            "name": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 20"
            },
            "avatar": {
              ".validate": "newData.isString()"
            },
            "team": {
              ".validate": "!newData.exists() || newData.val() === 'red' || newData.val() === 'blue'"
            },
            "role": {
              ".validate": "!newData.exists() || newData.val() === 'clueGiver' || newData.val() === 'guesser'"
            },
            "connected": {
              ".validate": "newData.isBoolean()"
            },
            "lastSeen": {
              ".validate": "newData.isNumber()"
            }
          }
        },

        "messages": {
          ".write": "auth != null && root.child('rooms').child($roomCode).child('ownerId').val() === auth.uid",
          "$messageId": {
            ".write": "auth != null",
            ".validate": "newData.hasChildren(['playerName', 'message', 'timestamp', 'type']) && newData.child('message').isString() && newData.child('message').val().length > 0 && newData.child('message').val().length <= 200",
            "playerId": {
              ".validate": "!newData.exists() || newData.isString()"
            },
            "playerName": {
              ".validate": "newData.isString() && newData.val().length > 0"
            },
            "message": {
              ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 200"
            },
            "timestamp": {
              ".validate": "newData.isNumber()"
            },
            "type": {
              ".validate": "newData.isString() && (newData.val() === 'clue' || newData.val() === 'chat' || newData.val() === 'system')"
            }
          }
        }
      }
    }
  }
}
